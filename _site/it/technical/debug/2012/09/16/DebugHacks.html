
<!DOCTYPE html>
<html lang="cn" xmlns:wb="http://open.weibo.com/wb">
  <head>
    <meta charset="utf-8">
    <title>DebugHacks</title>
    
    <meta name="author" content="王鹏程(PC)">

    <!-- sina weibo API -->
    <meta property="wb:webmaster" content="632e6945a16c1527" />
<!--必填-->
<meta property="og:type" content="article" />
<meta property="og:url" content="/it/technical/debug/2012/09/16/DebugHacks" />
<meta property="og:title" content="DebugHacks" />
<meta property="og:description" content=" " />
<!--选填-->
<meta name="weibo:article:create_at" content="2012-09-16" />

<meta name="weibo:article:update_at" content="2014-01-01" />

<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>

    <!-- sina weibo API END -->

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes//bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes//css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes//toc/css/toc.css" rel="stylesheet" type="text/css" media="screen">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">PC的程序员记录</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive">所有文章</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories">目录分类</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/search">站内检索</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags">标签云</a></li>
      	
      
    
  




          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
    <h1>
        DebugHacks
        <small>
            
            2018 程序啪啪啪
            
        </small>
    </h1>
    <wb:share-button appkey="2546085774" addition="number" type="button" ralateUid="1620259387" pic="http%3A%2F%2Fpic.yupoo.com%2Fqianjigui%2FDuruKAwV%2FyhZb1.jpg"></wb:share-button>

</div>

<div class="row">
  <div class="span8" id='main_content'>
    <h1 id="tocAnchor-1-1">DebugHacks</h1>

<h2 id="tocAnchor-1-1-1">思路图</h2>

<ul>
<li>Image

<ul>
<li><img src="http://pic.yupoo.com/qianjigui/ClqS2IyK/medish.jpg" alt="Don't Response" /></li>
<li><img src="http://pic.yupoo.com/qianjigui/ClqS39ys/medish.jpg" alt="AppExitUnUsual" /></li>
</ul>
</li>
<li>Invoke API

<ul>
<li>Debug API

<ul>
<li>valgrind</li>
<li>dump</li>
</ul>
</li>
<li>System status API

<ul>
<li>proc</li>
<li>sys</li>
</ul>
</li>
<li>System API

<ul>
<li>Invoke function</li>
</ul>
</li>
</ul>
</li>
<li>目录

<ul>
<li>http://book.douban.com/subject/6799412/</li>
</ul>
</li>
</ul>


<h2 id="tocAnchor-1-1-2">心得</h2>

<ul>
<li>复现

<ul>
<li>之前

<ul>
<li>配置环境</li>
<li>听取发现人的意见(先自己总结)</li>
<li>再次检查环境</li>
</ul>
</li>
<li>之后

<ul>
<li>确认现象</li>
<li>确认复现率和时间</li>
</ul>
</li>
</ul>
</li>
<li>分析时

<ul>
<li>目视确认现象</li>
<li>尽量缩小范围</li>
<li>根据内核配置、内核启动参数划分问题</li>
<li>根据版本划分问题</li>
<li>通过其他方法确认

<ul>
<li>lsusb</li>
<li>lsof</li>
<li>ip</li>
<li>route</li>
</ul>
</li>
<li>根据事实做出判断</li>
</ul>
</li>
<li>问题原因不明

<ul>
<li>怀疑硬件问题</li>
<li>找找以前改正的同类错误</li>
<li>无法复现、原因不明

<ul>
<li>增加log、方便下次定位</li>
</ul>
</li>
<li>为bug发生做准备

<ul>
<li>log</li>
<li>abort</li>
<li>assert</li>
</ul>
</li>
<li>跟同事讨论</li>
<li>咨询社区</li>
</ul>
</li>
</ul>


<h2 id="tocAnchor-1-1-3">Basic</h2>

<ul>
<li>CoreDump

<ul>
<li>OpenUse

<ul>
<li>ulimit -c unlimited</li>
<li>ulimit -c 1024</li>
<li>./a.out</li>
<li>file core*</li>
<li>gdb -c core.xxxx ./a.out</li>
</ul>
</li>
<li>OpenSystem</li>
<li>Space

<ul>
<li>ToSpecialDir</li>
<li>tar</li>
<li>MaskSharedMemoryDump</li>
</ul>
</li>
</ul>
</li>
<li>gdb

<ul>
<li>run</li>
<li>break

<ul>
<li>function</li>
<li>line-number</li>
<li>file:line</li>
<li>file:function</li>
<li>+offset</li>
<li>-offset</li>
<li>*addr</li>
</ul>
</li>
<li>backtrace</li>
<li>print</li>
<li>info reg</li>
<li>continue</li>
<li>next</li>
<li>step</li>
<li>set variabel var=exptr</li>
<li>generate-core-file</li>
<li>attach</li>
<li>break xxx if exptr</li>
<li>ignore breakpoint-number times</li>
<li>clear

<ul>
<li>all(no arg)</li>
<li>function</li>
<li>line</li>
<li>file:line</li>
<li>file:func</li>
</ul>
</li>
<li>delete bpn</li>
<li>disable

<ul>
<li>all(no arg)</li>
<li>bpn</li>
<li>display xxx</li>
<li>mem</li>
</ul>
</li>
</ul>
</li>
</ul>


<h2 id="tocAnchor-1-1-4">应用程序调试</h2>

<ul>
<li>SIGSEGV

<ul>
<li>系统层面的signal</li>
<li>Maybe

<ul>
<li>StackOverflow</li>
<li>WrongAddressAccess

<ul>
<li>NULL-pointer</li>
<li>Wrong-Pointer</li>
<li>OutOfBound-Memory</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>backtrace无法显示

<ul>
<li>Reason

<ul>
<li>程序栈被破坏</li>
<li>so没有源程序</li>
</ul>
</li>
<li>Find

<ul>
<li>根据被破坏的数据内容，查找执行写入的位置，看看有没有对栈空间(局部变量)的引用、指针传递处理</li>
</ul>
</li>
</ul>
</li>
<li>watch *addr</li>
<li>malloc/free

<ul>
<li>MALLOC_CHECK_</li>
</ul>
</li>
</ul>


<h2 id="tocAnchor-1-1-5">Android系统死机调试</h2>

<ul>
<li>发生死机时的测试

<ul>
<li>看屏幕与按键是否有反应</li>
<li>电话可否打入</li>
<li>USB可否连接</li>
</ul>
</li>
<li>USB测试

<ul>
<li>是否有事件产生</li>
<li>系统状态

<ul>
<li>CPU</li>
<li>Memory</li>
<li>Mount size</li>
</ul>
</li>
<li>SystemServer状况

<ul>
<li>信号级别调试</li>
</ul>
</li>
</ul>
</li>
</ul>


<h2 id="tocAnchor-1-1-6">Unix</h2>

<ul>
<li>Crash

<ul>
<li>Core dump</li>
<li>ulimit

<ul>
<li>设置和查看用户的使用的资源限制情况</li>
</ul>
</li>
</ul>
</li>
<li>内存泄露

<ul>
<li>Purify</li>
<li>valgrind</li>
<li>free</li>
</ul>
</li>
<li>性能不满足预期

<ul>
<li>prtdiag</li>
<li>prstat</li>
<li>top</li>
<li>ps

<ul>
<li>ps -e -o user,pid,ppid,tid,time,%cpu,cmd --sort=%cpu</li>
</ul>
</li>
</ul>
</li>
<li>句柄泄露

<ul>
<li>iostat

<ul>
<li>报告中央处理单元（中央处理器）统计和输入 / 输出设备和分区统计</li>
</ul>
</li>
<li>lsof</li>
</ul>
</li>
<li>Others

<ul>
<li>nm

<ul>
<li>显示目标文件的符号表信息</li>
</ul>
</li>
<li>ldd –显示动态库的依赖信息</li>
<li>pstack（Solaris， Linux）， procstack（AIX）– 打印十六进制地址和符号名称</li>
<li>pmap(Solaris, Linux), procmap(AIX) –打印地址空间映射</li>
<li>pldd(Solaris), procldd(AIX) —列出进程加载的库</li>
<li>pfiles(Solaris), procfiles(AIX)– 报告有关的所有文件描述符</li>
<li>prstat(Solaris), ps -e -o user,pid,ppid,tid,time,%cpu,cmd –sort=%cpu(Linux)– 检查每个线程的处理器</li>
<li>pwdx（Linux，Solaris）  pid 显示当前工作目录</li>
</ul>
</li>
<li><img src="http://pic.yupoo.com/qianjigui/CIwePulE/11Uyc9.jpg" alt="UnixProfile" /></li>
</ul>


<h2 id="tocAnchor-1-1-7">tools</h2>

<ul>
<li>strace

<ul>
<li>std:run with kernel invoke</li>
<li>-i: run with addr

<ul>
<li>gdb break by addr</li>
</ul>
</li>
<li>-p pid</li>
</ul>
</li>
<li>objdump</li>
<li>valgrind

<ul>
<li>check

<ul>
<li>memory leak</li>
<li>wrong address access</li>
<li>read uninited memory</li>
<li>access free mem</li>
<li>double free</li>
<li>stack error opt</li>
</ul>
</li>
</ul>
</li>
</ul>


<h2 id="tocAnchor-1-1-8">tags: Tool</h2>

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/it/technical/vm/2012/08/18/GC" title="垃圾收集技术">&larr; 老的一篇</a></li>
      
        <li><a href="/archive.html">归档列表</a></li>
      
        <li class="next"><a href="/it/technical/architecture/2012/09/21/BeautifulCode" title="BeautifulCode">新的一篇 &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  
<!-- Duoshuo Comment start -->
<div class="ds-thread" data-thread-key="/it/technical/debug/2012/09/16/DebugHacks" data-title="DebugHacks" data-url="http://www.5wpc.info/it/technical/debug/2012/09/16/DebugHacks/"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"qianjigui"};
(function() {
 var ds = document.createElement('script');
 ds.type = 'text/javascript';ds.async = true;
 ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
 ds.charset = 'UTF-8';
 (document.getElementsByTagName('head')[0]
  || document.getElementsByTagName('body')[0]).appendChild(ds);
 })();
</script>
<!-- Duoshuo Comment end -->





  </div>
  
  <div class="span4">
    <div id="toc-container"><table class="toc" id="toc"><tbody><tr><td><div id="toctitle"><h2>文章目录</h2></div><ul><li class="toc_level-1 toc_section-1"><a href="#tocAnchor-1-1"><span class="tocnumber">1</span> <span class="toctext">DebugHacks</span></a><ul><li class="toc_level-2 toc_section-2"><a href="#tocAnchor-1-1-1"><span class="tocnumber">1.1</span> <span class="toctext">思路图</span></a></li><li class="toc_level-2 toc_section-3"><a href="#tocAnchor-1-1-2"><span class="tocnumber">1.2</span> <span class="toctext">心得</span></a></li><li class="toc_level-2 toc_section-4"><a href="#tocAnchor-1-1-3"><span class="tocnumber">1.3</span> <span class="toctext">Basic</span></a></li><li class="toc_level-2 toc_section-5"><a href="#tocAnchor-1-1-4"><span class="tocnumber">1.4</span> <span class="toctext">应用程序调试</span></a></li><li class="toc_level-2 toc_section-6"><a href="#tocAnchor-1-1-5"><span class="tocnumber">1.5</span> <span class="toctext">Android系统死机调试</span></a></li><li class="toc_level-2 toc_section-7"><a href="#tocAnchor-1-1-6"><span class="tocnumber">1.6</span> <span class="toctext">Unix</span></a></li><li class="toc_level-2 toc_section-8"><a href="#tocAnchor-1-1-7"><span class="tocnumber">1.7</span> <span class="toctext">tools</span></a></li><li class="toc_level-2 toc_section-9"><a href="#tocAnchor-1-1-8"><span class="tocnumber">1.8</span> <span class="toctext">tags: Tool</span></a></li></ul></li></ul></td></tr></tbody></table></div>
    <h4>创建@</h4>
    <div class="date"><span>2012-09-16</span></div>
    
        <h4>最后修改@</h4>
        <div class="date"><span>2014-01-01</span></div>
    

  
    <h4>标签/Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="/tags.html#Tool-ref">Tool <span>7</span></a></li>
    
  



    </ul>
  

  
    <h4>相同类目/Categories</h4>
    <ul>
    
    
    


  
    
      
      	
      	<li><a href="/it/technical/debug/2018/05/29/GDB_LLDB">Gdb lldb 调试工具</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/it/technical/debug/2013/04/21/HowToDebug">HowToDebug</a></li>
      	
      
    
  
    
      
      	
      	<li class="active"><a href="/it/technical/debug/2012/09/16/DebugHacks" class="active">DebugHacks</a></li>
      	
      
    
  




    </ul>
  
  </div>
</div>


      </div>

      <footer>
    <p>&copy; 王鹏程(PC) 2010-2014
    with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
    and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
    <p>
    声明：文章版权属于王鹏程(PC)，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
    </p>
    </p>
</footer>


    </div> <!-- /container -->

    
  </body>
</html>

